

# ARP协议详解与分析



之前写过的一篇讲述`DHCP`协议的博客详细分析了在工作中遇到的内网和外网的网络设备连接关系及其出现的问题，在网络中，`DHCP`负责动态地为网络设备从服务器端提供相关配置信息，在内部网络中，配置终端的网络地址(`IPv4`与`IPv6`)是将设备连接到网络的第一步，相当于在网络中为设备指定了局域网内唯一的网络地址信息，之后如果设备想要与其他的终端进行联系，在同一网段下的设备交流并不需要复杂的转发流程，但是与不同网段下或者跨网络互联设备下的终端之间进行通讯，那么就需要更加复杂的网络协议来进行支撑，在这个过程中，对于一个传统的`IPv4`网络，`ARP`协议就起了很大的作用。

在上次解决网络环境的问题中，为了排查路由器设备上的网络跳线连接的交换机的端口`MAC`地址及其网关地址之间的关系，使用了`windows`环境下的下的`arp`命令来找到 `MAC`地址和对应网关接口的物理关系。



## ARP的概念及其原理

`ARP` (Address Resolution Protocol)，地址解析协议，是一个通过解析网络层地址来寻找数据链路层地址的网络传输协议，其在传统的`IPv4`网络中非常重要，是将网络地址和`MAC`地址相互关联起来。

**ARP协议解决的问题**

在以太网的规定，在同一个局域网下的不同终端之间的通讯不仅仅要求需要知道彼此的网络地址信息，并且需要明确终端设备的唯一标识符 - `MAC`地址。 在传统的网络层协议 `TCP/IP`中，对于传输层和网络层来说，这两层在网络通信中更加关注目标终端的网络地址，因此需要一种办法来解决`网络地址`和`MAC地址`的映射关系，`ARP`协议的出现为这种问题带来了解决办法。

对于 `ARP` 协议中的 **地址解析** 的含义，就是在 终端A 想要给 终端B 发送数据帧之前将终端B的`网络地址`解析为`MAC地址`。

在不同的局域网下的终端如果想要进行通讯，那么就要经过路由器的转发，在这个过程中，`ARP`协议获得的可能不是真实的目的主机的MAC地址，而是一台通往外部的路由器的MAC地址，这个过程中，配置通往外部的路由器可以不需要制定外部的路由表，这个情况下我们称为路由器的这种模式为 **ARP代理**(ARP Proxy)，但是在这种模式下，参照华为HCNP教程

下边我们用一个例子来解释ARP代理的含义。



























